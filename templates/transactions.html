{% extends "base.html" %}
{% block header_subtitle %}Integrated Stripe checkout with edge/cloud processing{% endblock %}

{% block content %}

<div class="tabs-container">
  <div class="card">

    <!-- Card Header -->
    <div class="card-header">
      <div class="stat-card-icon icon-bg-green" style="border-radius: 8px;">
        <i class="fas fa-money-bill-wave"></i>
      </div>
      <div style="flex-grow: 1; margin-left: 16px;">
        <h2 class="card-title" style="margin: 0;">Initiate Transfer</h2>
        <p class="card-subtitle" style="margin: 4px 0 0 0;">
          Enter transaction details to begin secure checkout
        </p>
      </div>
    </div>

    <!-- Form -->
    <form id="payment-form" class="demo-form">

      <!-- Recipient -->
      <div class="form-group" style="margin-bottom: 24px;">
        <div
          style="background: var(--sidebar-accent-bg); padding: 12px; border-radius: 8px; display: flex; align-items: center; justify-content: space-between;">
          <span style="font-weight: 500; font-size: 0.9rem; color: var(--text-color);">Current Balance</span>
          <span id="user-balance-display" style="font-weight: 700; font-size: 1.1rem; color: var(--teal-primary);">RM
            --</span>
        </div>
      </div>

      <div class="form-group">
        <label for="recipientAccount">Recipient Account / Merchant</label>
        <input type="text" id="recipientAccount" class="form-input" placeholder="e.g. 1122003344" required>
      </div>

      <!-- Amount -->
      <div class="form-group">
        <label for="amount">Amount (RM)</label>
        <div style="position: relative;">
          <span style="position: absolute; left: 12px; top: 10px; color: var(--muted-text);">RM</span>
          <input type="number" id="amount" class="form-input" style="padding-left: 40px;" placeholder="0.00" min="1.00"
            step="0.01" required>
        </div>
      </div>

      <!-- Reference -->
      <div class="form-group">
        <label for="reference">Reference (Optional)</label>
        <input type="text" id="reference" class="form-input" placeholder="e.g. Invoice Payment">
      </div>

      <!-- Stripe Payment Element -->
      <div class="form-group">
        <label for="payment-element">Payment Method</label>
        <div id="payment-element" class="form-input" style="padding: 12px; min-height: 180px;"></div>
        <div id="payment-errors" style="color: #fa755a; margin-top: 6px; font-size: 0.9em;"></div>
      </div>

      <!-- Message -->
      <div id="payment-message" class="alert-banner" style="display: none; margin-top: 16px;"></div>

      <!-- Submit -->
      <div class="form-footer" style="display: flex; flex-direction: column; text-align: center;">
        <button type="submit" id="payment-submit-btn" class="btn-sync"
          style="width: 100%; background-color: #635bff; font-size: 1rem; padding: 12px;">
          Proceed to Payment
        </button>

        <p style="font-size: 0.8rem; color: var(--muted-text); margin-top: 12px;">
          <i class="fas fa-lock"></i> Secured by Stripe
        </p>

        <div style="margin-top: 8px; gap: 8px; display: flex; justify-content: center;">
          <span style="font-size: 0.7rem;"><i class="fas fa-credit-card"></i> Card</span>
          <span style="font-size: 0.7rem;"><i class="fas fa-university"></i> FPX</span>
          <span style="font-size: 0.7rem;"><i class="fas fa-wallet"></i> GrabPay</span>
        </div>
      </div>

    </form>
  </div>

  <!-- Recent Transactions -->
  <div class="card" style="margin-top: 24px;">
    <div class="card-body">
      <div class="table-responsive">
        <table class="custom-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Amount</th>
              <th>Status</th>
              <th>Processed At</th>
              <th>Datetime</th>
              <th>Recipient</th>
              <th>Reference</th>
              <th>Merchant</th>
              <th>Device ID</th>
              <th>Customer ID</th>
            </tr>
          </thead>
          <tbody id="txn-table-body"></tbody>
        </table>
      </div>

      <!-- Pagination Controls -->
      <div id="pagination-controls"
        style="display: flex; justify-content: center; align-items: center; margin-top: 20px; gap: 15px;">
        <button id="prev-page-btn" class="btn-sync" style="padding: 8px 16px; font-size: 0.9rem;" disabled>
          <i class="fas fa-chevron-left"></i>
        </button>
        <span id="page-info" style="font-size: 0.9rem; color: var(--text-color);">Page 1</span>
        <button id="next-page-btn" class="btn-sync" style="padding: 8px 16px; font-size: 0.9rem;" disabled>
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Transaction Details Modal -->
<div id="txn-modal" class="modal-overlay" style="display: none;">
  <div class="modal-content card">
    <div class="modal-header">
      <h2 class="card-title">Transaction Details</h2>
      <button class="close-modal-btn" onclick="closeTxnModal()">&times;</button>
    </div>
    <div class="modal-body" id="txn-modal-body">
      <!-- Details injected by JS -->
    </div>
    <div class="modal-footer" id="txn-modal-footer">
      <!-- Actions injected by JS -->
    </div>
  </div>
</div>

{% endblock %}